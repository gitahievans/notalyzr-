(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{30285:(e,s,r)=>{"use strict";r.d(s,{$:()=>o});var t=r(95155),l=r(12115),a=r(99708),n=r(74466),i=r(59434);let c=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=l.forwardRef((e,s)=>{let{className:r,variant:l,size:n,asChild:o=!1,...d}=e,u=o?a.DX:"button";return(0,t.jsx)(u,{className:(0,i.cn)(c({variant:l,size:n,className:r})),ref:s,...d})});o.displayName="Button"},43405:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>V});var t=r(95155),l=r(12115),a=r(5041),n=r(85057),i=r(38280),c=r(54395),o=r(26884),d=r(6942),u=r(30285);let m=async e=>{let s=new FormData;e.pdf_file&&(s.append("pdf_file",e.pdf_file),s.append("title",e.pdf_file.name||"Untitled Score"),s.append("composer","Anonymous"),s.append("analyze","true"));let r=await fetch("".concat("http://127.0.0.1:8000","/api/upload/"),{method:"POST",body:s});if(!r.ok)throw Error((await r.json()).message||"Failed to upload file");return r.json()};function x(e){let{onUploadSuccess:s,isProcessing:r}=e,[x,h]=(0,l.useState)([]),[f,g]=(0,l.useState)(null),{mutate:v,isPending:p}=(0,a.n)({mutationFn:m,onSuccess:e=>{d.$e.show({title:"Success",message:e.message||"File uploaded successfully",color:"green",icon:(0,t.jsx)(i.A,{}),position:"top-center"}),h([]),g(null),s(e.score_id,e.task_id)},onError:e=>{g(e.message),d.$e.show({title:"Error",message:e.message,color:"red",icon:(0,t.jsx)(c.A,{}),position:"top-center"})}}),j=e=>"application/pdf"!==e.type?(g("Only PDF files are allowed"),!1):!(e.size>5242880)||(g("File size exceeds 5MB limit"),!1),b=(0,l.useCallback)(e=>{if(r)return;g(null);let s=e.filter(j);s.length>0&&h([s[0]])},[r]);return(0,t.jsx)("div",{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),!r&&x[0]&&v({pdf_file:x[0]})},children:[(0,t.jsx)(n.J,{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Upload PDF Music Score"}),(0,t.jsx)("div",{className:"border-2 border-dashed rounded-lg p-6 cursor-pointer\n            ".concat(x.length?"border-orange-500 bg-orange-50":"border-gray-300","\n            ").concat(f?"border-red-500 bg-red-50":"","\n            ").concat(r?"opacity-50 cursor-not-allowed":"hover:border-orange-500","\n            transition-colors"),onDrop:e=>{e.preventDefault(),r||b(Array.from(e.dataTransfer.files))},onDragOver:e=>e.preventDefault(),onClick:()=>{if(r)return;let e=document.createElement("input");e.type="file",e.accept=".pdf",e.onchange=e=>{let s=e.target;s.files&&b(Array.from(s.files))},e.click()},children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[x.length?(0,t.jsx)(o.A,{size:52,className:"text-orange-500"}):(0,t.jsx)(i.A,{size:52,className:"text-gray-400"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl",children:x.length?"".concat(x.length," file selected"):"Drag a PDF file here or click to select"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Maximum file size: 5MB"}),f&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-2",children:f})]})]})}),x.length>0&&(0,t.jsx)("div",{className:"space-y-4 mt-4",children:x.map((e,s)=>(0,t.jsx)("div",{className:"bg-orange-50 rounded-md overflow-hidden border border-orange-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.A,{size:24,className:"text-orange-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:e.name})]}),(0,t.jsx)(u.$,{variant:"ghost",size:"sm",onClick:()=>{h([]),g(null)},disabled:r,children:(0,t.jsx)(c.A,{size:20})})]})},s))}),(0,t.jsx)(u.$,{type:"submit",disabled:p||!x.length||r,className:"mt-4 bg-orange-500 hover:bg-orange-600 text-white",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Uploading..."]}):"Upload Score"})]})})}var h=r(78426),f=r(9196),g=r(41698),v=r(20375),p=r(91226),j=r(59434);let b=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...l})});b.displayName="Card";let N=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("flex flex-col space-y-1.5 p-6",r),...l})});N.displayName="CardHeader";let y=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});y.displayName="CardTitle",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("text-sm text-muted-foreground",r),...l})}).displayName="CardDescription";let w=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("p-6 pt-0",r),...l})});w.displayName="CardContent",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("flex items-center p-6 pt-0",r),...l})}).displayName="CardFooter";var k=r(32960);let S=(0,l.createContext)(void 0),A="http://127.0.0.1:8000";console.log("API_URL_FROM_CONTEXT:",A);let M=async(e,s)=>{let r=await fetch("".concat(A,"/api/scores/").concat(e,"/?task_id=").concat(s));if(!r.ok)throw Error((await r.json()).message||"Failed to fetch score");let t=await r.json();return console.log("Parsed Score data from Context:",t),t},R=e=>{let{scoreId:s,taskId:r,children:l}=e,{data:a,error:n,isLoading:i,refetch:c}=(0,k.I)({queryKey:["score",s,r],queryFn:()=>M(s,r),enabled:!!s&&!!r,refetchInterval:e=>{var s,r;let t=e.state.data;return!!t&&(null==t?void 0:null===(s=t.task_status)||void 0===s?void 0:s.state)==="PENDING"&&(null==t||null===(r=t.score)||void 0===r||!r.processed)&&3e3},retry:(e,s)=>!(e>=3)});return(0,t.jsx)(S.Provider,{value:{scoreData:a,isLoading:i,error:n,refetch:c},children:l})},C=()=>{let e=(0,l.useContext)(S);if(void 0===e)throw Error("useScoreData must be used within a ScoreDataProvider");return e};var E=r(34477);let _=(0,E.createServerReference)("404c3fd98075ccb965f87f21bff74f72e1999ff978",E.callServer,void 0,E.findSourceMapURL,"generateSummaryFromResults");var F=r(16809);let L=F.bL,D=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)(F.B8,{ref:s,className:(0,j.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...l})});D.displayName=F.B8.displayName;let P=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)(F.l9,{ref:s,className:(0,j.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...l})});P.displayName=F.l9.displayName;let I=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)(F.UC,{ref:s,className:(0,j.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...l})});I.displayName=F.UC.displayName;let U=(0,r(74466).F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),T=l.forwardRef((e,s)=>{let{className:r,variant:l,...a}=e;return(0,t.jsx)("div",{ref:s,role:"alert",className:(0,j.cn)(U({variant:l}),r),...a})});T.displayName="Alert",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("h5",{ref:s,className:(0,j.cn)("mb-1 font-medium leading-none tracking-tight",r),...l})}).displayName="AlertTitle";let z=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,j.cn)("text-sm [&_p]:leading-relaxed",r),...l})});z.displayName="AlertDescription";var X=r(52655);let O=()=>(0,t.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,t.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading sheet music..."})]}),$=e=>{let{message:s}=e;return(0,t.jsx)("div",{className:"flex items-center justify-center p-8 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-red-600 text-lg font-semibold mb-2",children:"Error Loading Sheet Music"}),(0,t.jsx)("div",{className:"text-red-500 text-sm",children:s})]})})},G=e=>{let{musicXML:s,width:r,height:a,showLoadingSpinner:n=!0,className:i="",onLoad:c,onError:o,renderingOptions:d={}}=e,u=(0,l.useRef)(null),m=(0,l.useRef)(null),[x,h]=(0,l.useState)(!1),[f,g]=(0,l.useState)(null),v=(0,l.useCallback)(async()=>{if(u.current&&s){h(!0),g(null);try{var e,r,t;u.current.innerHTML="",m.current=new X.OpenSheetMusicDisplay(u.current,{autoResize:!0,backend:"svg",drawTitle:null===(e=d.drawTitle)||void 0===e||e,drawComposer:null===(r=d.drawComposer)||void 0===r||r,drawFingerings:null!==(t=d.drawFingerings)&&void 0!==t&&t,drawCredits:!1,drawPartNames:!0,followCursor:!1,defaultColorMusic:"#1f1f1f",pageFormat:d.pageFormat||"A4_P"}),await m.current.load(s),m.current.render(),console.log("MusicXML rendered successfully"),h(!1),null==c||c()}catch(s){let e=s instanceof Error?s.message:"Unknown error occurred";console.error("Error loading MusicXML:",s),g(e),h(!1),null==o||o(e)}}},[s,d,c,o]);return(0,l.useEffect)(()=>{s&&u.current&&v()},[s,v]),(0,l.useEffect)(()=>()=>{if(m.current){try{m.current.clear()}catch(e){console.warn("Error during OSMD cleanup:",e)}m.current=null}},[]),(0,t.jsxs)("div",{className:"osmd-wrapper ".concat(i),children:[x&&n&&(0,t.jsx)(O,{}),f&&(0,t.jsx)($,{message:f}),(0,t.jsx)("div",{ref:u,className:"osmd-container p-6 min-h-[400px] overflow-auto",style:{width:r?"".concat(r,"px"):"100%",height:a?"".concat(a,"px"):"auto",display:x||f?"none":"block"}}),!1]})},B="http://127.0.0.1:8000";function H(e){var s,r,a,n,i,c,o,d,m;let{onProcessingChange:x}=e,{scoreData:j,isLoading:k,error:S,refetch:A}=C(),{summary:M,isGenerating:R,error:E,generateSummary:F,canGenerate:U}=function(){var e,s,r;let{scoreData:t,isLoading:a}=C(),[n,i]=(0,l.useState)(null),[c,o]=(0,l.useState)(!1),[d,u]=(0,l.useState)(null),m=!!((null==t?void 0:null===(e=t.score)||void 0===e?void 0:e.processed)&&(null==t?void 0:null===(s=t.score)||void 0===s?void 0:s.results)&&!a),x=(0,l.useCallback)(async()=>{var e;if(m&&(null==t?void 0:null===(e=t.score)||void 0===e?void 0:e.results)){o(!0),u(null);try{let e=await _({analysisResults:t.score.results,scoreTitle:t.score.title});i(e)}catch(e){console.error("Error generating summary:",e),u(e instanceof Error?e.message:"Failed to generate summary")}finally{o(!1)}}},[m,t]);return(0,l.useEffect)(()=>{i(null),u(null)},[null==t?void 0:null===(r=t.score)||void 0===r?void 0:r.id]),{summary:n,isGenerating:c,error:d,generateSummary:x,canGenerate:m}}(),[X,O]=(0,l.useState)(!1),[$,H]=(0,l.useState)(null),[V]=(0,l.useState)({drawTitle:!0,drawComposer:!0,drawFingerings:!1}),[q,W]=(0,l.useState)(null),[J,K]=(0,l.useState)(0);return(console.log("ScoreData from context:",j),(0,l.useEffect)(()=>{var e,s,r;(null==j?void 0:null===(e=j.score)||void 0===e?void 0:e.processed)||(null==j?void 0:null===(s=j.task_status)||void 0===s?void 0:s.state)==="FAILURE"?x(!1):((null==j?void 0:null===(r=j.task_status)||void 0===r?void 0:r.state)==="PENDING"||k)&&x(!0)},[j,k,x]),(0,l.useEffect)(()=>{var e,s;(null==j?void 0:null===(e=j.score)||void 0===e?void 0:e.processed)&&(null==j?void 0:null===(s=j.task_status)||void 0===s?void 0:s.state)!=="PENDING"&&(async()=>{try{var e,s;console.log("Attempting to fetch MusicXML from:","".concat(B).concat(null==j?void 0:null===(e=j.score)||void 0===e?void 0:e.musicxml_url));let r=await fetch("".concat(B).concat(null==j?void 0:null===(s=j.score)||void 0===s?void 0:s.musicxml_url),{method:"GET",headers:{Accept:"application/xml, text/xml, application/vnd.recordare.musicxml+xml, */*"}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status," - ").concat(r.statusText));let t=r.headers.get("content-type");console.log("Response content type:",t);let l=await r.text();if(console.log("Response length:",l.length),console.log("First 200 characters:",l.substring(0,200)),!l.trim().startsWith("<?xml")&&!l.trim().startsWith("<"))throw Error("Response is not valid XML format");l.includes("score-partwise")||l.includes("score-timewise")||console.warn("Warning: Content doesn't appear to be MusicXML format"),W(l),H(null),K(0),console.log("MusicXML fetched successfully")}catch(s){let e=s instanceof Error?s.message:"Unknown error";if(console.error("Failed to fetch MusicXML:",e),J<3&&(e.includes("network")||e.includes("timeout"))){console.log("Retrying fetch attempt ".concat(J+1,"/3")),K(e=>e+1),setTimeout(()=>{},2e3*(J+1));return}H("Failed to fetch MusicXML: ".concat(e)),W(null),K(0)}})()},[null==j?void 0:null===(s=j.score)||void 0===s?void 0:s.processed,null==j?void 0:null===(r=j.task_status)||void 0===r?void 0:r.state,J]),S)?(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"h-6 w-6"})," Score Analysis Results"]}),(0,t.jsxs)(b,{children:[(0,t.jsx)(N,{children:(0,t.jsx)(y,{children:"Error"})}),(0,t.jsxs)(w,{children:[(0,t.jsx)("p",{children:S.message}),(0,t.jsx)(u.$,{className:"mt-4",onClick:()=>A(),children:"Retry"})]})]})]}):k||j||S?(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"h-6 w-6"})," Score Analysis Results"]}),k||j&&!(null===(a=j.score)||void 0===a?void 0:a.processed)&&(null===(n=j.task_status)||void 0===n?void 0:n.state)==="PENDING"?(0,t.jsx)(b,{children:(0,t.jsxs)(w,{className:"flex items-center justify-center p-6",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mr-2"}),(0,t.jsx)("p",{children:(null==j?void 0:null===(i=j.task_status)||void 0===i?void 0:i.info)||"Let the magic unfold, it might take a while..."})]})}):(0,t.jsxs)(L,{defaultValue:"results",className:"w-full",children:[(0,t.jsxs)(D,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(P,{value:"results",children:"Analysis Results"}),(0,t.jsx)(P,{value:"musicxml",children:"Sheet Music"}),(0,t.jsx)(P,{value:"summary",children:"AI Summary"})]}),(0,t.jsx)(I,{value:"results",children:(0,t.jsxs)(b,{children:[(0,t.jsx)(N,{children:(0,t.jsx)(y,{children:(null==j?void 0:null===(c=j.score)||void 0===c?void 0:c.title)||"No title"})}),(0,t.jsx)(w,{children:(null==j?void 0:null===(o=j.score)||void 0===o?void 0:o.results)?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-blue-600 mb-1",children:"Key Signature"}),(0,t.jsx)("div",{className:"text-lg font-bold text-blue-900",children:j.score.results.key})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border border-green-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-green-600 mb-1",children:"Time Signature"}),(0,t.jsx)("div",{className:"text-lg font-bold text-green-900",children:j.score.results.time_signature})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-lg border border-amber-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-amber-600 mb-1",children:"Parts"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-amber-900",children:null===(d=j.score.results.parts)||void 0===d?void 0:d.join(", ")})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-purple-600 mb-1",children:"MusicXML"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 text-purple-700"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:q?"Available":"Not Available"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"A few chords detected"})}),j.score.results.chords&&j.score.results.chords.length>0?(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:j.score.results.chords.map((e,s)=>(0,t.jsxs)("div",{className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("Chord Symbol Cannot Be Identified"===e.pitch?"bg-red-100 text-red-700 border border-red-200":"bg-blue-100 text-blue-700 border border-blue-200 hover:bg-blue-200"),children:[(0,t.jsx)("span",{className:"font-semibold",children:e.pitch}),(0,t.jsxs)("span",{className:"ml-2 text-xs opacity-75",children:["@",e.offset]})]},s))})}):(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border text-center text-gray-500",children:"No chord progression detected"})]})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-2",children:(0,t.jsx)(h.A,{className:"h-12 w-12 mx-auto"})}),(0,t.jsx)("p",{className:"text-gray-500",children:"No analysis results available for this score."})]})})]})}),(0,t.jsx)(I,{value:"musicxml",children:(0,t.jsxs)(b,{children:[(0,t.jsxs)(N,{children:[(0,t.jsxs)(y,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Sheet Music Viewer"]}),q&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Rendered from: ",(null==j?void 0:null===(m=j.score)||void 0===m?void 0:m.title)||"Untitled Score"]})]}),(0,t.jsx)(w,{children:q?(0,t.jsxs)("div",{className:"space-y-4",children:[$&&(0,t.jsx)(T,{variant:"destructive",children:(0,t.jsxs)(z,{children:["Failed to load sheet music: ",$]})}),$&&(0,t.jsx)(T,{className:"mb-4",children:(0,t.jsx)(z,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["Error loading sheet music: ",$]}),(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>{K(0),H(null),W(null),A()},className:"ml-4",children:"Retry"})]})})}),X&&!$&&(0,t.jsx)(T,{children:(0,t.jsx)(z,{className:"text-green-700",children:"Sheet music loaded successfully! You can scroll and zoom to explore the notation."})}),(0,t.jsx)("div",{className:"w-full min-h-[600px] bg-white rounded-lg border border-gray-200",children:(0,t.jsx)(G,{musicXML:q,showLoadingSpinner:!0,onLoad:()=>{console.log("MusicXML loaded successfully in OSMD"),O(!0),H(null)},onError:e=>{console.error("OSMD Error:",e),H(e),O(!1)},renderingOptions:V,className:"w-full h-full",height:600})}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[(0,t.jsx)("div",{children:"Use mouse wheel to zoom, click and drag to pan"}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([q],{type:"application/xml"}),s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download="score.musicxml",r.click(),URL.revokeObjectURL(s)},children:"Download MusicXML"})})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)(f.A,{className:"h-16 w-16 mx-auto"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No MusicXML Available"}),(0,t.jsx)("p",{className:"text-gray-500 max-w-md mx-auto",children:"The sheet music notation is not available for this score. This could happen if the analysis is still processing or if the original image couldn't be converted to MusicXML format."}),(null==j?void 0:j.score)&&!j.score.processed&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsxs)(u.$,{variant:"outline",onClick:()=>A(),className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Check Again"]})})]})})]})}),(0,t.jsx)(I,{value:"summary",children:(0,t.jsxs)(b,{children:[(0,t.jsx)(N,{children:(0,t.jsxs)(y,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-5 w-5"}),"AI-Generated Musical Analysis"]})}),(0,t.jsx)(w,{children:U?M||R?R?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mr-2"}),(0,t.jsx)("p",{children:"Generating AI summary..."})]}):E?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(T,{variant:"destructive",children:(0,t.jsx)(z,{children:E})}),(0,t.jsxs)(u.$,{onClick:F,variant:"outline",children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Retry"]})]}):M?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:M.summary})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Musical Characteristics"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:M.musicalCharacteristics})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Harmonic Analysis"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:M.harmonicAnalysis})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Structural Insights"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:M.structuralInsights})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Performance Notes"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:M.performanceNotes})]}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsxs)(u.$,{onClick:F,variant:"outline",size:"sm",children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Regenerate"]})})]}):null:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Generate an AI-powered musical analysis and summary of this score."}),(0,t.jsxs)(u.$,{onClick:F,className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Generate AI Summary"]})]}):(0,t.jsx)(T,{children:(0,t.jsx)(z,{children:"Analysis results are required before generating an AI summary."})})})]})})]})]}):(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"h-6 w-6"})," Score Analysis Results"]}),(0,t.jsx)(b,{children:(0,t.jsx)(w,{className:"p-6 text-center",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Upload or select a score to see analysis results."})})})]})}function V(){let[e,s]=(0,l.useState)(null),[r,a]=(0,l.useState)(null),[n,i]=(0,l.useState)(!1);return(0,t.jsx)("div",{className:"min-h-screen bg-orange-50 text-foreground font-main",children:(0,t.jsxs)("div",{className:"container mx-auto flex flex-col",children:[(0,t.jsxs)("header",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-primary",children:"Score Insights"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Upload music scores to extract key musical elements and generate summaries."})]}),(0,t.jsx)("section",{className:"mb-6",children:(0,t.jsx)(x,{onUploadSuccess:(e,r)=>{s(e),a(r),i(!0)},isProcessing:n})}),(0,t.jsx)("section",{className:"grid grid-cols-1 md:grid-cols-1 gap-6 mb-8 w-full ".concat(n?"border-2 border-dashed":""),children:(0,t.jsx)(R,{scoreId:e,taskId:r,children:(0,t.jsx)(H,{onProcessingChange:i})})})]})})}},59434:(e,s,r)=>{"use strict";r.d(s,{cn:()=>a});var t=r(52596),l=r(39688);function a(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,l.QP)((0,t.$)(s))}},85057:(e,s,r)=>{"use strict";r.d(s,{J:()=>o});var t=r(95155),l=r(12115),a=r(40968),n=r(74466),i=r(59434);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)(a.b,{ref:s,className:(0,i.cn)(c(),r),...l})});o.displayName=a.b.displayName},95272:(e,s,r)=>{Promise.resolve().then(r.bind(r,43405))}},e=>{var s=s=>e(e.s=s);e.O(0,[849,433,724,306,441,684,358],()=>s(95272)),_N_E=e.O()}]);